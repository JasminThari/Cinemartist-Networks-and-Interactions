Newlyweds Shrek and Princess Fiona return from their honeymoon to find they have been invited by Fiona's parents to a royal ball to celebrate their marriage. Shrek initially refuses to attend, but Fiona convinces him, and along with Donkey, they travel to the kingdom of Far Far Away. They meet Fiona's parents, King Harold and Queen Lillian, who are shocked to see the ogres, with Harold particularly repulsed. At dinner, Shrek and Harold get into a heated argument, and Fiona, disgusted at their behavior, locks herself away in her room. Shrek worries that he is losing Fiona, particularly after finding her childhood diary and reading that she was once infatuated with Prince Charming.

Harold is secretly reprimanded by the Fairy Godmother, as her son, Prince Charming, was to marry Fiona in exchange for Harold's own happy ending. She orders him to get rid of Shrek, so Harold arranges for Puss in Boots to assassinate him under the guise of a hunting trip. Unable to defeat Shrek, Puss reveals that he was paid by Harold and offers to be an ally. Shrek, Donkey, and Puss sneak into the Fairy Godmother's factory and steal a "Happily Ever After" potion that Shrek thinks will make him good enough for Fiona. Shrek and Donkey both drink the potion but nothing happens. Shrek laments before he and Donkey both suddenly fall asleep. Meanwhile, in Far Far Away, Fiona prepares to find Shrek so they can return home, but she too falls asleep.

Without warning, the potion transforms Shrek and Fiona into humans, and Donkey into a white stallion for the following morning. In order to make the change permanent, Shrek must kiss Fiona by midnight. Shrek, Donkey, and Puss return to the castle. However, the Fairy Godmother, having discovered the theft, has sent Charming to pose as Shrek and win Fiona's love. At the Fairy Godmother's urging, Shrek leaves the castle, believing that the best way to make Fiona happy is to let her go.

Fiona does not reciprocate Charming's advances, so to ensure she falls in love with Charming, the Fairy Godmother gives Harold a love potion to put into Fiona's tea. This exchange is overheard by Shrek, Donkey, and Puss, who are arrested by the royal knights after Donkey inadvertently exposes them. While the royal ball begins, the fairy tale creatures whom Shrek and Donkey had met during their previous adventure arrive at the dungeon to rescue the trio, and they all storm the castle with the help of a monstrous living gingerbread man created by the Muffin Man.

Shrek fails to prevent Charming from kissing Fiona, but instead of falling in love, Fiona headbutts him; Harold reveals that he swapped Fiona's tea that has the love potion with his tea. The now-enraged Fairy Godmother tries to kill Shrek with her magic wand, but Harold jumps in front of it, reverting into the Frog Prince; the spell ricochets off his armor and evaporates her into bubbles. With the Fairy Godmother gone, Harold apologizes, admitting to using the "Happily Ever After" potion years earlier to gain Lillian's love, and approves Shrek and Fiona's marriage, while Lillian assures Harold that she still loves him. As the clock strikes midnight, Fiona declines Shrek's offer to remain human, and they revert into ogres, while Donkey also returns to normal. In the mid-credits scene, Dragon, who had previously married Donkey, reveals that they now have several dragon-donkey hybrid babies.

